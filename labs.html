<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Appendix B — Computational labs – Ecological theory for the biodiversity crisis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./intro_to_R.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./intro_to_R.html">Appendices</a></li><li class="breadcrumb-item"><a href="./labs.html"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Computational labs</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Ecological theory for the biodiversity crisis</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/hmlfpereira/theoeco-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Ecological-theory-for-the-biodiversity-crisis.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Ecology of individuals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ecophysiology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Ecophysiology and the climate space: when to bask in the sun?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optimalforaging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Economic models of behavior: do animals optimize?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gametheory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Conflict resolution in ecology and evolution: war and peace</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./movement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Movement and dispersal<strong>:</strong> should I stay or should I go?</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Ecology of populations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./demography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Demography: boom or bust</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Ecology of communities</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modellingbiochange.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modelling biodiversity change: winners and losers</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_to_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">A brief R tutorial</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./labs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Computational labs</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#climate-space-of-an-ectotherm" id="toc-climate-space-of-an-ectotherm" class="nav-link active" data-scroll-target="#climate-space-of-an-ectotherm"><span class="header-section-number">B.1</span> Climate space of an ectotherm</a></li>
  <li><a href="#optimal-foraging-theory" id="toc-optimal-foraging-theory" class="nav-link" data-scroll-target="#optimal-foraging-theory"><span class="header-section-number">B.2</span> Optimal foraging theory</a></li>
  <li><a href="#evolutionary-games" id="toc-evolutionary-games" class="nav-link" data-scroll-target="#evolutionary-games"><span class="header-section-number">B.3</span> Evolutionary games</a></li>
  <li><a href="#dispersal-and-the-random-walk" id="toc-dispersal-and-the-random-walk" class="nav-link" data-scroll-target="#dispersal-and-the-random-walk"><span class="header-section-number">B.4</span> Dispersal and the random-walk</a></li>
  <li><a href="#pandemic-growth" id="toc-pandemic-growth" class="nav-link" data-scroll-target="#pandemic-growth"><span class="header-section-number">B.5</span> Pandemic growth</a></li>
  <li><a href="#population-viability-analysis" id="toc-population-viability-analysis" class="nav-link" data-scroll-target="#population-viability-analysis"><span class="header-section-number">B.6</span> Population Viability Analysis</a></li>
  <li><a href="#the-camera-trapper" id="toc-the-camera-trapper" class="nav-link" data-scroll-target="#the-camera-trapper"><span class="header-section-number">B.7</span> The camera trapper</a></li>
  <li><a href="#managing-a-fishery" id="toc-managing-a-fishery" class="nav-link" data-scroll-target="#managing-a-fishery"><span class="header-section-number">B.8</span> Managing a fishery</a></li>
  <li><a href="#road-kill" id="toc-road-kill" class="nav-link" data-scroll-target="#road-kill"><span class="header-section-number">B.9</span> Road Kill</a></li>
  <li><a href="#simulating-a-neutral-community" id="toc-simulating-a-neutral-community" class="nav-link" data-scroll-target="#simulating-a-neutral-community"><span class="header-section-number">B.10</span> Simulating a neutral community</a></li>
  <li><a href="#monitoring-biodiversity" id="toc-monitoring-biodiversity" class="nav-link" data-scroll-target="#monitoring-biodiversity"><span class="header-section-number">B.11</span> Monitoring biodiversity</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/hmlfpereira/theoeco-book/blob/main/labs.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./intro_to_R.html">Appendices</a></li><li class="breadcrumb-item"><a href="./labs.html"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Computational labs</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Appendix B — Computational labs</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="climate-space-of-an-ectotherm" class="level2" data-number="B.1">
<h2 data-number="B.1" class="anchored" data-anchor-id="climate-space-of-an-ectotherm"><span class="header-section-number">B.1</span> Climate space of an ectotherm</h2>
<p>Solar radiation and convection are the two main pathways for animals such as small lizards. In this case, the total heat flux (<em>f</em>) into the animal is given by the <strong>heat flux equation</strong>:</p>
<p><span class="math display">\[f = q\ –h*(b - a)\]</span></p>
<ul>
<li><p><span class="math inline">\(q\)</span> = solar radiation (cal/h)</p></li>
<li><p><span class="math inline">\(h*(b - a)\)</span> = heat loss through convection</p></li>
<li><p><span class="math inline">\(b\)</span> = body temperature of the animal (ºC)</p></li>
<li><p><span class="math inline">\(a\)</span> = air temperature (ºC)</p></li>
<li><p><span class="math inline">\(h\)</span> = convection heat transfer coefficient (cal/h/ ºC)</p></li>
</ul>
<ol type="1">
<li><strong><em>Equilibrium body temperature</em></strong>
<ol type="a">
<li>Assuming that air temperature is 18ºC, and <strong>h</strong> = 50 cal/h, plot the lizard’s equilibrium body temperature as a function of solar radiation. Assume that solar radiation varies between 0 and 1500 cal/h</li>
</ol></li>
<li><strong><em>Climate space of a Lizard</em></strong>
<ol type="a">
<li><p>Draw the climate space of the lizard by drawing the polygon that is limited by the minimum and maximum temperatures that the lizard can support, as a function of solar radiation. Consider that the upper lethal limit for the body temperature (<strong><em>bmax</em></strong>) is 36ºC and the lower lethal limit for the body temperature (<strong><em>bmin</em></strong>) is 24ºC.</p>
<p><strong>Hint:</strong> <code>polygon</code> - draws the polygons whose vertices are given in x and y.</p></li>
</ol></li>
<li><strong><em>Air Temperature and solar radiation throughout the day in two locations</em></strong>
<ol type="a">
<li><p>Plot the following values of air temperature and solar radiation that are available throughout a day in two locations. For:</p>
<ul>
<li><p>Times of the day</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"00:00"</span>,<span class="st">"03:00"</span>,<span class="st">"06:00"</span>,<span class="st">"09:00"</span>,<span class="st">"12:00"</span>,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"15:00"</span>,<span class="st">"18:00"</span>,<span class="st">"21:00"</span>,<span class="st">"00:00"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Solar radiation in the rock habitat</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>rock_q <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">150</span>,<span class="dv">150</span>,<span class="dv">800</span>,<span class="dv">1100</span>,<span class="dv">1300</span>,<span class="dv">1200</span>,<span class="dv">800</span>,<span class="dv">400</span>,<span class="dv">150</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Air temperature in the rock habitat</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>rock_a <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">18</span>,<span class="dv">13</span>,<span class="dv">10</span>,<span class="dv">14</span>,<span class="dv">21</span>,<span class="dv">24</span>,<span class="dv">22</span>,<span class="dv">20</span>,<span class="dv">18</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Solar radiation in the bush habitat</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>bush_q <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">150</span>,<span class="dv">150</span>,<span class="dv">450</span>,<span class="dv">600</span>,<span class="dv">650</span>,<span class="dv">650</span>,<span class="dv">350</span>,<span class="dv">200</span>,<span class="dv">150</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Air temperature in the bush habitat</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>bush_a <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">18</span>,<span class="dv">13</span>,<span class="dv">10</span>,<span class="dv">14</span>,<span class="dv">21</span>,<span class="dv">24</span>,<span class="dv">22</span>,<span class="dv">20</span>,<span class="dv">18</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><p>At which time of the day is the lizard on the rock, and at which time is it at the bush? Is there any time when the lizard cannot be at any of the locations?</p></li>
</ol></li>
<li><strong><em>Body temperature of A. cristatellus in two different habitats</em></strong></li>
</ol>
<p><a href="ecophysiology.html#sec-anolis_cristatellus" class="quarto-xref"><span>Section 1.4.2</span></a> presents a data frame containing data on individuals <em>A. cristatellus</em> living in urban and forested areas in three cities in Puerto Rico, giving us the perfect opportunity to assess the potential thermal effects of habitat upon this species. To do this:</p>
<ol type="a">
<li>Make a linear model for individuals of <em>A. cristatellus</em> living only in natural habitats (<code>context</code> = <code>natural</code>) and another for individuals living in urban habitats (<code>context</code> = <code>urban</code>).</li>
</ol>
<p><strong>Hint:</strong> to filter the data you can use the <code>subset</code> function in R</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example filtering data from anoles only from San Jose sites</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df_sanjose <span class="ot">&lt;-</span> <span class="fu">subset</span>(df, Site <span class="sc">==</span> <span class="st">"San Jose"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="a">
<li><p>Is there a habitat where lizards are consistently warmer? If so, provide an ecological explanation (quantitatively) for this observation (assume an ambient temperature of 30 °C).</p></li>
<li><p>Is your model appropriate for explaining your data?</p></li>
</ol>
<div style="page-break-after: always;"></div>
</section>
<section id="optimal-foraging-theory" class="level2" data-number="B.2">
<h2 data-number="B.2" class="anchored" data-anchor-id="optimal-foraging-theory"><span class="header-section-number">B.2</span> Optimal foraging theory</h2>
<ol type="1">
<li><p><strong>Predator with a strategy for maximizing energy.</strong><br>
Let <strong><em>ai</em></strong> be the point abundance per unit of time of prey type <strong><em>i</em></strong>, <strong><em>ei</em></strong> be the caloric content of prey type <strong><em>i</em></strong>, <strong><em>hi</em></strong> be the time it takes to consume prey type <strong><em>i</em></strong>, <strong><em>ew</em></strong> is the energy expended per unit of time by the predator while searching for prey, and <strong><em>eh</em></strong> is the energy expended per unit of time by the predator to ingest prey. Consider that there are only two types of prey and that:</p>
<p>Strategy 1: Chosing prey of type 1<br>
Strategy 2: Chosing prey of type 2<br>
Strategy 3: Chosing both preys</p>
<ol type="a">
<li><p>Show that if <strong><em>e1&gt; e2</em></strong> and <strong><em>h1 &lt;h2</em></strong> then the second strategy is never a optimal strategy</p></li>
<li><p>Plot and comment the graph of the energy gain per unit of time for the strategy of consuming both preys and for the strategy of consuming only the best prey. Make the abundances vary between 0.005 and 0.5 ind/s for the best prey. Consider the abundance of the worse prey to be 0.05 ind/s and 0.01 ind/s. Consider an active predator with the following physiological parameters:</p>
<p><strong><em>e1</em></strong> = 10J; <strong><em>e2</em></strong> = 100J; <strong><em>h1</em></strong> = 1s; <strong><em>h2</em></strong> = 60s; <strong><em>ew</em></strong> = 1 J/s; <strong><em>eh</em></strong> = 1 J/S</p></li>
</ol></li>
<li><p><strong>Predator with a strategy of sit-and-wait.</strong><br>
<strong><em>Ew</em></strong> is the energy expended per unit of time by the predator while waiting for its prey, <strong><em>ep</em></strong> is the energy expended per unit of time by the predator while chasing the prey, v is the velocity of the predator in chase and <strong><em>a</em></strong> is the point abundance of preys per unit of time.</p>
<ol type="a">
<li>Produce a graph of energy gain per unit of time in function of the size of the feeding territory. Consider the following values for the parameters of the predator and prey: <strong><em>ew</em></strong> = 0,1 J/s; <strong><em>ep</em></strong> = 1 J/S; <strong><em>v</em></strong> = 0,5 m/s; <strong><em>a</em></strong> = 0,005 ind/s/m2; and <strong><em>e</em></strong> = 10;</li>
</ol></li>
</ol>
<div style="page-break-after: always;"></div>
</section>
<section id="evolutionary-games" class="level2" data-number="B.3">
<h2 data-number="B.3" class="anchored" data-anchor-id="evolutionary-games"><span class="header-section-number">B.3</span> Evolutionary games</h2>
<ol type="1">
<li><strong>The Prisoners Dilemma Competition</strong>. In this class we will have a competition of algorithms for playing the prisoner’s dilemma.
<ol type="a">
<li>Write a function that takes as parameters two vectors that account with the history of the previous plays and returns one play (i.e., Cooperate – “C” or defect – “D”). This play should try to be the best response to the history of past moves. One example of such a function is:</li>
</ol></li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>    strat<span class="ot">&lt;-</span><span class="cf">function</span>(own,opponent)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        n <span class="ot">&lt;-</span> <span class="fu">length</span>(opponent)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span>(n<span class="sc">==</span><span class="dv">0</span>) <span class="st">"D"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span>(own[n]<span class="sc">==</span><span class="st">"D"</span>) opponent[n]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>               <span class="cf">else</span> <span class="st">"C"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="a">
<li><p>Use the function pd_sim (see below) to play your strategy with the strategy of the other groups (ask for each group their function(s)) and with itself, in an iterative game with x moves. Compare the results of the cumulative rewards as well as the sequence of moves. Report to the rest of groups the values of the rewards for each of the tournaments. What was the best strategy? What strategies are best responses to themselves?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pd_sim<span class="ot">&lt;-</span><span class="cf">function</span>(p1_strat,p2_strat,n)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a> w1<span class="ot">&lt;-</span><span class="dv">0</span>          <span class="co">#accumulated pay-off (fitness) of player 1</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a> w2<span class="ot">&lt;-</span><span class="dv">0</span>          <span class="co">#accumulated pay-offs of player 2</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a> h1<span class="ot">&lt;-</span><span class="cn">NULL</span>       <span class="co">#history of plays of player 1</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a> h2<span class="ot">&lt;-</span><span class="cn">NULL</span>       <span class="co">#history of plays of player 2</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n)            </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>   {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    a1<span class="ot">&lt;-</span><span class="fu">p1_strat</span>(h1,h2) </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    a2<span class="ot">&lt;-</span><span class="fu">p2_strat</span>(h2,h1) </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    p1<span class="ot">&lt;-</span>mat[a1,a2] </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    p2<span class="ot">&lt;-</span>mat[a2,a1]         </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    w1<span class="ot">&lt;-</span>w1<span class="sc">+</span>p1              </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    w2<span class="ot">&lt;-</span>w2<span class="sc">+</span>p2             </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    h1[t]<span class="ot">&lt;-</span>a1                   </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>h2[t]<span class="ot">&lt;-</span>a2                   }   </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a> <span class="fu">list</span>(<span class="at">w1=</span>w1,<span class="at">w2=</span>w2,<span class="at">h1=</span>h1,<span class="at">h2=</span>h2)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ol>
<div style="page-break-after: always;"></div>
</section>
<section id="dispersal-and-the-random-walk" class="level2" data-number="B.4">
<h2 data-number="B.4" class="anchored" data-anchor-id="dispersal-and-the-random-walk"><span class="header-section-number">B.4</span> Dispersal and the random-walk</h2>
<ol type="1">
<li><strong>Random walk for 1 individual</strong>
<ol type="a">
<li>Create your own code to simulate an individual random walk. Assume that the starting point is always x,y =(0,0) and the probability of an individual to choose any direction (i.e.&nbsp;left, right, up or down) is the same. It should be a function taking as argument the number of steps and returning a list of two vectors, one with the x positions over time and another with the y positions overtime.</li>
<li>Plot together the random walks (at least 5000 steps) of a few individuals. <img src="./images/Lab_RandomWalk.png" class="img-fluid"></li>
</ol></li>
<li><strong>Random walk for several (n) individuals</strong>
<ol type="a">
<li>Create your own code to simulate random walks by several (<strong><em>n</em></strong>)individuals and returns the last position of each individual. It should be a function that takes as arguments the number of individuals and the numbers of time steps, and returns a list of two vectors, the last x position of each individual, and the last y position of each individual.</li>
<li>Create a histogram showing the distribution of the x and y last positions of 10 000 individuals after 10 time steps, 100 time steps and 1 000 time steps.</li>
<li>Create a function that receives as parameters a vector of values xlast, a mean value (meanx) and a standard deviation (stdx) and returns the log-likelihood of observing those values for those parameters.</li>
<li>Find the value meanx and stdx that maximize the likelihood of the observations. Are they the same as mean(xlast) and std(xlast)? Why?</li>
<li><strong>Extra credit:</strong> Create a histogram showing the distribution of the distance to the origin (sqrt(x^+y^2)) of the last positions of 10 000 individuals for 10 time steps, 100 time steps, 1000 time steps and 10000 time steps. What is the relationship between the length of the randomwalk and the mean distance? Fit the Rayleigh distribution (2 r / sigma^2) * exp(-r^2/2 sigma^2) using non-linear fitting to each of the histograms and overlay it on the graph.</li>
</ol></li>
</ol>
<div style="page-break-after: always;"></div>
</section>
<section id="pandemic-growth" class="level2" data-number="B.5">
<h2 data-number="B.5" class="anchored" data-anchor-id="pandemic-growth"><span class="header-section-number">B.5</span> Pandemic growth</h2>
<ol type="1">
<li><p><strong>The exponential dynamics of the pandemic.</strong> In early 2020, the first wave of the global pandemic of COVID-19 hit several European countries. Here we will plot the data for those countries and fit an exponential growth model.</p>
<ol type="a">
<li>Load the cumulative infected individuals time series from the COVID-19 pandemic in five countries. Each time series starts after the first fifteen infections are detected.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>it <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">79</span>, <span class="dv">132</span>, <span class="dv">229</span>, <span class="dv">322</span>, <span class="dv">400</span>, <span class="dv">650</span>, <span class="dv">888</span>, <span class="dv">1128</span>, <span class="dv">1689</span>, <span class="dv">2036</span>, <span class="dv">2502</span>, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="dv">3089</span>, <span class="dv">3858</span>, <span class="dv">4636</span>, <span class="dv">5883</span>, <span class="dv">7375</span>, <span class="dv">9172</span>, <span class="dv">10149</span>, <span class="dv">12462</span>, <span class="dv">15113</span>, <span class="dv">17660</span>, <span class="dv">21157</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="dv">23980</span>, <span class="dv">27980</span>, <span class="dv">31506</span>, <span class="dv">35713</span>, <span class="dv">41035</span>, <span class="dv">47021</span>, <span class="dv">53578</span>) <span class="co">#Feb22-March22</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>es <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">35</span>, <span class="dv">54</span>, <span class="dv">82</span>, <span class="dv">136</span>, <span class="dv">192</span>, <span class="dv">267</span>, <span class="dv">348</span>, <span class="dv">531</span>, <span class="dv">764</span>, <span class="dv">1094</span>, <span class="dv">1527</span>, <span class="dv">2299</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3274</span>, <span class="dv">4427</span>, <span class="dv">5958</span>, <span class="dv">7641</span>, <span class="dv">9785</span>, <span class="dv">11491</span>, <span class="dv">13994</span>, <span class="dv">17688</span>, <span class="dv">21735</span>, <span class="dv">26304</span>, <span class="dv">31750</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="dv">36616</span>, <span class="dv">41262</span>, <span class="dv">48953</span>, <span class="dv">57506</span>, <span class="dv">66460</span>, <span class="dv">75641</span>) <span class="co">#Feb27-March27</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>fr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">38</span>, <span class="dv">57</span>, <span class="dv">100</span>, <span class="dv">130</span>, <span class="dv">178</span>, <span class="dv">212</span>, <span class="dv">285</span>, <span class="dv">423</span>, <span class="dv">613</span>, <span class="dv">716</span>, <span class="dv">1126</span>, <span class="dv">1412</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1784</span>, <span class="dv">2281</span>, <span class="dv">2876</span>, <span class="dv">3661</span>, <span class="dv">4499</span>, <span class="dv">5423</span>, <span class="dv">6633</span>, <span class="dv">7730</span>, <span class="dv">9134</span>, <span class="dv">10995</span>, <span class="dv">12612</span>, <span class="dv">14459</span>, </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="dv">16018</span>, <span class="dv">19856</span>, <span class="dv">22302</span>, <span class="dv">25233</span>, <span class="dv">29155</span>) <span class="co">#Feb27-March27</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>uk <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">22</span>, <span class="dv">30</span>, <span class="dv">42</span>, <span class="dv">47</span>, <span class="dv">69</span>, <span class="dv">109</span>, <span class="dv">164</span>, <span class="dv">220</span>, <span class="dv">271</span>, <span class="dv">352</span>, <span class="dv">412</span>, <span class="dv">469</span>, <span class="dv">617</span>, </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="dv">876</span>, <span class="dv">1282</span>, <span class="dv">1766</span>, <span class="dv">2244</span>, <span class="dv">2605</span>, <span class="dv">3047</span>, <span class="dv">3658</span>, <span class="dv">4427</span>, <span class="dv">5426</span>, <span class="dv">6481</span>, <span class="dv">7736</span>, <span class="dv">8934</span>, </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="dv">10312</span>, <span class="dv">12650</span>, <span class="dv">15025</span>, <span class="dv">17717</span>) <span class="co">#Feb27-March27</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>de <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">21</span>, <span class="dv">47</span>, <span class="dv">57</span>, <span class="dv">111</span>, <span class="dv">129</span>, <span class="dv">157</span>, <span class="dv">196</span>, <span class="dv">262</span>, <span class="dv">400</span>, <span class="dv">684</span>, <span class="dv">847</span>, <span class="dv">902</span>, <span class="dv">1139</span>, </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="dv">1296</span>, <span class="dv">1567</span>, <span class="dv">2369</span>, <span class="dv">3062</span>, <span class="dv">3795</span>, <span class="dv">4838</span>, <span class="dv">6012</span>, <span class="dv">7156</span>, <span class="dv">8198</span>, <span class="dv">14138</span>, <span class="dv">18187</span>, <span class="dv">21463</span>, </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="dv">24774</span>, <span class="dv">29212</span>, <span class="dv">31554</span>, <span class="dv">36508</span>) <span class="co">#Feb26-March26</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="a">
<li>Plot the data in a linear plot, coloring each country with a different colour. What do you observe?</li>
<li>Plot the data in a semi-log plot (using the plot option <code>log=”y”</code>), coloring each country with a different color. What do you observe?</li>
<li>Carry out a linear regression with the data of each country (using the log of the n values) and estimate the growth rate R. Are the values the same for all countries? Do they vary over time?</li>
<li>Knowing that <span class="math display">\[R_0 = R^\tau\]</span> and that the infectious period (<span class="math inline">\(\tau\)</span>) duration is 10 days, what are the <span class="math inline">\(R_0\)</span>’s in different countries?</li>
<li>Write a for loop to simulate geometric (exponential) growth, going from time t in 1:100, and storing the population size values at each time step t+1 in variable n based on the population values at time t, i.e.&nbsp;<code>n[t+1]&lt;-R*n[t]</code>. Don’t forget to initialize the population size before the for loop with <code>n&lt;-1</code>. Plot a couple of runs of the for loop with different R values (for instance <code>R=1.01</code> and <code>R=1.1</code>) in linear scale.</li>
<li>Given that you know the solution of the geometric growth equation to be <span class="math inline">\(n(t)=n_0 R^t\)</span>, create a vector of values with this formula using the same R as you used above, but starting with <code>n0&lt;-2</code> and overlay them on the plot.</li>
</ol></li>
</ol>
<div style="page-break-after: always;"></div>
</section>
<section id="population-viability-analysis" class="level2" data-number="B.6">
<h2 data-number="B.6" class="anchored" data-anchor-id="population-viability-analysis"><span class="header-section-number">B.6</span> Population Viability Analysis</h2>
<p><img src="./images/IUCN_redlist.png" class="img-fluid"></p>
<ol type="1">
<li><p>Consider a population with exponential growth but that exhibits environmental stochasticity, with the logarithm of the population growth rate following a normal distribution with mean <span class="math inline">\(\bar{r}=\log(\bar{R})\)</span> and variance <span class="math inline">\(v\)</span>. Assume that the population has an on-off density dependence and cannot grow above the carrying capacity <span class="math inline">\(K\)</span>. According to Foley (1994)<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> the expect time to extinction is <span class="math display">\[T=\frac{1}{s r}[e^{s \log(k)}(1-e^{-s \log(N_0)} )-s \log(N_0)]\]</span> where <span class="math inline">\(s=2r/v\)</span>.</p>
<ol type="a">
<li><p>Plot the mean extinction times, <span class="math inline">\(T\)</span>, as a function of <span class="math inline">\(r\)</span>, <span class="math inline">\(v\)</span>, <span class="math inline">\(n_0\)</span>, and <span class="math inline">\(K\)</span>. Please comment each plot. <span class="math inline">\(r\)</span> can carry from 0.01 to 0.2, <span class="math inline">\(v\)</span> can vary from 0.05 to 1.0, <span class="math inline">\(n0\)</span> can vary from 0 to 10, and <span class="math inline">\(K\)</span> can vary from 10 to 500. Use as base parameters <code>n0=10</code>, <code>K=100</code>, <code>v=0.3</code> and <code>r=0.01</code>.</p></li>
<li><p>Write a function that simulates a population with these dynamics numerically. Start by using the for loop that you developed in Lab 2 and modify it to include a carrying capacity and growth rate that is taken every year from a normal distribution. The function should take parameter <code>n0</code>, <code>r</code>, <code>v</code>, and <code>K</code>. It should return the vector of the population sizes over time.</p></li>
<li><p>Simulate the dynamics with the following parameters:</p>
<ol type="1">
<li><code>n0=3</code>; <code>r=0.01</code>; <code>v=0.2</code>; <code>K=500</code></li>
<li><code>n0=100</code>; <code>r=0.01</code>; <code>v=0.2</code>; <code>K=500</code>;</li>
</ol></li>
<li><p><strong>Extended credit</strong>: Compare the model predictions with the results from the analytical approximation of Foley. You need to do many simulations to reach the predicted extinction times from Foley. For instance, you can create a function that call the function developed in (b) and executes it 100 times, returning the median time to extinction across the simulations.</p></li>
</ol></li>
</ol>
<div style="page-break-after: always;"></div>
</section>
<section id="the-camera-trapper" class="level2" data-number="B.7">
<h2 data-number="B.7" class="anchored" data-anchor-id="the-camera-trapper"><span class="header-section-number">B.7</span> The camera trapper</h2>
<p>A researcher place camera traps at a grid of sites during 19 days to observe roe-deer.</p>
<ol type="1">
<li><p>Load the data on the file roe_deer_2016_r.csv into R. Briefly describe the structure of the dataset.</p></li>
<li><p>Case 1: Ignoring detection probability.</p>
<ol type="a">
<li>Build a vector that for each site takes value 1 when roe-deer is present and 0 when is absent.</li>
<li>Using maximum-likelihood estimate the occupancy probability (<span class="math inline">\(\psi\)</span>). First create a function that takes as parameters psi and a vector of presence/absences and returns the likelihood. Then plot that function for a range of <span class="math inline">\(\Psi\)</span> values and find the <span class="math inline">\(\psi\)</span> value that maximizes the function.</li>
<li>Assume that based on previous work we know that occupancy is somewhat between 0.2 and 0.5. Using a Bayesian approach, calculate the posterior probability distribution for the occupancy <span class="math inline">\(P(\psi)\)</span>.</li>
</ol>
<p>Help: A function returning the <span class="math inline">\(P(\psi|data)\)</span> . It takes as parameters a vector <code>y</code> of presences/absences, a value for <code>psi</code>, and a function for the prior distribution of <span class="math inline">\(\psi\)</span> named <code>priorpsi</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>occupancybayesian <span class="ot">&lt;-</span> <span class="cf">function</span>(y,psi,priorpsi)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  integrand <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">occupancylikelihood</span>(y,x)<span class="sc">*</span><span class="fu">priorpsi</span>(x)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">occupancylikelihood</span>(y,psi)<span class="sc">*</span><span class="fu">priorpsi</span>(psi)<span class="sc">/</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">integrate</span>(integrand, <span class="at">lower =</span> <span class="fl">0.01</span>, <span class="at">upper =</span> <span class="fl">0.99</span>)<span class="sc">$</span>value</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A function returning <span class="math inline">\(P(\psi)\)</span>, the prior distribution of <span class="math inline">\(\psi\)</span> values. It takes as parameters a value for <code>psi.</code></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="cf">function</span>(psi) </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>{ </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dunif</span>(psi,<span class="fl">0.2</span>,<span class="fl">0.5</span>) </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Case 2: Using a hierarchical model with detection probability</p>
<ol type="a">
<li>Using maximum-likelihood estimate the occupancy probability (<span class="math inline">\(\Psi\)</span>) and detection probability (<span class="math inline">\(p\)</span>).</li>
</ol></li>
</ol>
<p><img src="./images/RoeDeer.jpg" class="img-fluid"></p>
<div style="page-break-after: always;"></div>
</section>
<section id="managing-a-fishery" class="level2" data-number="B.8">
<h2 data-number="B.8" class="anchored" data-anchor-id="managing-a-fishery"><span class="header-section-number">B.8</span> Managing a fishery</h2>
<ol type="1">
<li>Consider that you are managing a fishery with the following dynamics: <span class="math display">\[dn/dt = 0.2 n (1-n/10000) \]</span>
<ol type="a">
<li>Plot the production function of the fishery, indicating the stock size for the maximum sustainable yield and the corresponding production level.</li>
<li>Suppose you establish an annual quota (harvest) that is equivalent to 50% of the maximum sustainable yield. What are the two stock size levels that sustainably allow that exploitation level?</li>
<li>Explore what happen when you manage this fishery for 100 years. Start by writing a function that simulates the logistic growth above with a constant harvest. The function should take as parameters the initial population size n0 (the stock of the fishery), the annual harvest h, and the number of years for which you simulate the population dynamics and return a vector with the population sizes over time. Discuss the results of the following experiments.
<ul>
<li><strong>Experiment 1:</strong> Set the harvest equal to the production at MSY and initial population size at carrying capacity.</li>
<li><strong>Experiment 2</strong>. Set the harvest equal to the production at MSY and initial population size at the stock size of MSY</li>
<li><strong>Experiment 3.</strong> Set the harvest equal to 50% of the maximum sustainable yield and initial population size at carrying capacity.</li>
<li><strong>Experiment 4.</strong> Set the harvest equal to the production at MSY and initial population size at the stock size of MSY - 1000 individuals.</li>
<li><strong>Experiment 5.</strong> Set the harvest equal to the production at MSY and initial population size at the stock size of MSY - 1000 individuals.</li>
</ul></li>
<li>Explain why in a system with constant quotas, MSY is not stable and should not be the management goal.</li>
<li><strong>Extra credit</strong>: Modify the logistic growth function to have stochastic dynamics so that there is a variance of 10% in the annual productivity. Simulate again experiment 2 a few times. What happens?</li>
<li>Discuss how these results relate with the paper of Worm et al (2009) about the need to rebuild fisheries.</li>
</ol></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/Gadus_morhua.JPG" class="img-fluid figure-img"></p>
<figcaption>Atlantic cod (Gadus morhua). Source: Hans-Petter Fjeld, CC-BY-SA, Wikipedia.</figcaption>
</figure>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="road-kill" class="level2" data-number="B.9">
<h2 data-number="B.9" class="anchored" data-anchor-id="road-kill"><span class="header-section-number">B.9</span> Road Kill</h2>
<p><strong>Populations in space and the impacts of roads</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 49%">
<col style="width: 50%">
</colgroup>
<tbody>
<tr class="odd">
<td><p><em>The <strong>Red fox</strong></em></p>
<p><em>…So, while they may be most active at night.</em></p>
<p><em>Red foxes are especially active during the</em></p>
<p><em>daytime in <strong>spring and summer (April-Sept)</strong></em></p>
<p><em>as they are foraging for food to feed their young.</em></p>
<p>Source photo: Wikipedia, CC0.</p></td>
<td><img src="./images/RedFox.jpg" class="img-fluid quarto-figure quarto-figure-right" width="345"></td>
</tr>
</tbody>
</table>
<p><strong>Goals of the exercise</strong>:</p>
<ul>
<li><p>Identify road segments with hotspots of red fox-car-collisions.</p></li>
<li><p>What impact do activity patterns have on the rate of animal-car-collision hotspots?</p></li>
<li><p>Use the False Discovery Rate (FDR) method to identify such hotspots.</p></li>
</ul>
<ol type="1">
<li>Please install the following R packages</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fuzzySim)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="a">
<li>Load the <em>roadkill</em> dataset.</li>
<li>Explain the structure of the dataset.</li>
<li>Show that differences in seasonal activity patterns impact the FDR hotspot results in red fox-car-collisions.</li>
<li>How many hotspots were detected for the active season?</li>
<li>Plot, based on the FDR method, true and “false” hotspots. Explain the general geographic locations of the hotspots and those vary between the two different seasons.</li>
<li>Think about conservation management implications.</li>
</ol>
<div style="page-break-after: always;"></div>
</section>
<section id="simulating-a-neutral-community" class="level2" data-number="B.10">
<h2 data-number="B.10" class="anchored" data-anchor-id="simulating-a-neutral-community"><span class="header-section-number">B.10</span> Simulating a neutral community</h2>
<!--# Laura Quintero prepared first version? -->
<p>The neutral theory in ecology provides a mechanistic explanation for species abundance distributions. It seeks to understand the impact of speciation, extinction, dispersal and ecological drift on the species abundance distribution (SAD), assuming that all species have equal opportunities (Hubbell, 2001).</p>
<p>It is important to note that the neutral theory is a model created to explain a pattern of relative abundance within communities, but it does not necessarily reflect reality (communities’ mechanisms). The neutral theory utilizes a model based on the dynamics of a species’ population, which is governed by generalized birth and death events, including speciation, immigration, and emigration (Rosindell et al (2011).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/neutral.png" class="img-fluid figure-img"></p>
<figcaption>Diagram of the dynamics of communities in the neutral theory of biodiversity (from Rosindell et al 2011).</figcaption>
</figure>
</div>
<p>The neutral theory paradox is that in absence of migration or mutation diversity gradually declines to zero or monodominance. Let’s see what happens to species richness and the species abundance distribution over time for different parameters of the model. Start by installing the package <code>untb.</code></p>
<ol type="1">
<li><p><strong>Without mutation or dispersal (pure ecological drift):</strong> We start with a local community with 20 species, each with 25 individuals. The simulation then runs for 2500 generations where 10 individuals die per generation. Mutation rate is zero and immigration rate is zero</p>
<ol type="a">
<li><p>Plot the number of species over time.</p></li>
<li><p>Plot the species abundance distribution at time 1, 100 and 2500</p></li>
<li><p>Plot the map of individuals at those time steps.</p></li>
</ol></li>
<li><p><strong>With point mutation:</strong> Same parameters as (1) but with speciation rate of 0.1.</p>
<ol type="a">
<li><p>Plot the number of species over time.</p></li>
<li><p>Plot the species abundance distribution at time 1, 100 and 2500</p></li>
<li><p>Plot the map of individuals at those time steps.</p></li>
</ol></li>
<li><p><strong>[Extra Credit] With immigration:</strong> Same parameters as (1) but immigration rate greater than zero. Play with different abundance distributions for the metacommunity.</p></li>
</ol>
<div style="page-break-after: always;"></div>
</section>
<section id="monitoring-biodiversity" class="level2" data-number="B.11">
<h2 data-number="B.11" class="anchored" data-anchor-id="monitoring-biodiversity"><span class="header-section-number">B.11</span> Monitoring biodiversity</h2>
<ol type="1">
<li>Exploring the BBS dataset
<ol type="a">
<li>Load the file Florida.csv into R. Briefly describe the structure of the dataset.</li>
<li>Map the monitored transects/routes in Florida’s map. Use the maps library to plot the counties of florida as a base map.</li>
<li>For transect 4 and transect 109 in year 2018 plot calculate the species richness, Shannon diversity index H and evenness J of both transects, with H being <span class="math display">\[H=-\sum_i (p_i \ln p_i)\]</span> where <span class="math inline">\(p_i\)</span> is defined as the proportion of individuals found in species <span class="math inline">\(i\)</span>. Compare the two transects.</li>
<li>Plot the species abundance distribution and abundance-rank for both transects. What do you observe?</li>
<li>Choose one transect and plot the species richness, Shannon diversity, and geometric mean abundance over time</li>
<li><em>Extra credit 1:</em> Produce a map of the trends of one these metrics across Florida (for instance coloring different points according to the trend)</li>
<li><em>Extra credit 2:</em> Estimate the number of species in Florida by combining the different transects and using one of the estimators. Use bootstrap and/or jacknife to calculate confidence intervals.</li>
</ol></li>
</ol>
<div style="page-break-after: always;"></div>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Data source: <a href="https://github.com/owid/covid-19-data/tree/master/public/data" class="uri">https://github.com/owid/covid-19-data/tree/master/public/data</a>, accessed 8 Nov 2020<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Foley, P. (1994) Predicting Extinction Times from Environmental Stochasticity and Carrying-Capacity. <em>Conservation Biology</em> <strong>8</strong>: 124–137.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro_to_R.html" class="pagination-link" aria-label="A brief R tutorial">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">A brief R tutorial</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/hmlfpereira/theoeco-book/blob/main/labs.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div></div></footer></body></html>